import {
  enable,
  getAddress,
  getBalance,
  getCollateral,
  getNetworkId,
  getRewardAddress,
  getUtxos,
  isEnabled,
  off,
  on,
  signData,
  signDataCIP30,
  signTx,
  submitTx,
} from '../../api/webpage';
import { EVENT } from '../../config/config';

//dApp connector API follows https://github.com/cardano-foundation/CIPs/pull/88

const logDeprecated = () => {
  console.warn(
    'This Nami API implementation is deprecated soon. Please follow the API under the window.cardano.lucem namespace. For more information check out CIP-30: https://github.com/cardano-foundation/CIPs/tree/master/CIP-0030'
  );
  return true;
};

//Initial version (deprecated soon)
window.cardano = {
  ...(window.cardano || {}),
  enable: () => logDeprecated() && enable(),
  isEnabled: () => logDeprecated() && isEnabled(),
  getBalance: () => logDeprecated() && getBalance(),
  signData: (address, payload) => logDeprecated() && signData(address, payload),
  signTx: (tx, partialSign) => logDeprecated() && signTx(tx, partialSign),
  submitTx: (tx) => logDeprecated() && submitTx(tx),
  getUtxos: (amount, paginate) => logDeprecated() && getUtxos(amount, paginate),
  getCollateral: () => logDeprecated() && getCollateral(),
  getUsedAddresses: async () => logDeprecated() && [await getAddress()],
  getUnusedAddresses: async () => logDeprecated() && [],
  getChangeAddress: () => logDeprecated() && getAddress(),
  getRewardAddress: () => logDeprecated() && getRewardAddress(),
  getNetworkId: () => logDeprecated() && getNetworkId(),
  onAccountChange: (callback) =>
    logDeprecated() && on(EVENT.accountChange, callback),
  onNetworkChange: (callback) =>
    logDeprecated() && on(EVENT.networkChange, callback),
  off,
  _events: {},
};

// // CIP-30

window.cardano = {
  ...(window.cardano || {}),
  lucem: {
    enable: async () => {
      if (await enable()) {
        return {
          getBalance: () => getBalance(),
          signData: (address, payload) => signDataCIP30(address, payload),
          signTx: (tx, partialSign) => signTx(tx, partialSign),
          submitTx: (tx) => submitTx(tx),
          getUtxos: (amount, paginate) => getUtxos(amount, paginate),
          getUsedAddresses: async () => [await getAddress()],
          getUnusedAddresses: async () => [],
          getChangeAddress: () => getAddress(),
          getRewardAddresses: async () => [await getRewardAddress()],
          getNetworkId: () => getNetworkId(),
          experimental: {
            on: (eventName, callback) => on(eventName, callback),
            off: (eventName, callback) => off(eventName, callback),
            getCollateral: () => getCollateral(),
          },
        };
      }
    },
    isEnabled: () => isEnabled(),
    apiVersion: '0.1.0',
    name: 'Lucem',
    icon: "data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 500 500'%3E%3Cdefs%3E%3Cstyle%3E.cls-1%7Bfill:%23CCFA00;%7D%3C/style%3E%3C/defs%3E%3Cg id='Layer_2' data-name='Layer 2'%3E%3Cg id='Layer_1-2' data-name='Layer 1'%3E%3Cpath id='path16' class='cls-1' d='M194.857 1.196 C 190.763 3.453,188.848 6.591,188.504 11.609 C 187.579 25.107,204.304 29.516,209.918 17.254 C 214.401 7.463,203.865 -3.770,194.857 1.196 M293.734 11.227 C 289.327 12.072,286.789 15.109,286.481 19.904 C 285.721 31.725,299.650 34.468,303.926 23.339 C 306.137 17.583,299.808 10.062,293.734 11.227 M101.211 11.954 C 91.756 15.871,94.053 30.800,104.111 30.800 C 115.334 30.800,115.971 12.892,104.800 11.446 C 103.523 11.281,102.480 11.428,101.211 11.954 M125.125 53.970 C 120.433 55.805,117.600 58.924,116.176 63.824 C 112.137 77.717,127.353 88.601,137.907 79.369 C 149.293 69.409,138.828 48.613,125.125 53.970 M265.881 53.751 C 253.527 58.372,253.254 75.637,265.438 81.801 C 277.063 87.683,288.964 71.188,281.526 59.501 C 278.356 54.518,271.028 51.825,265.881 53.751 M196.698 65.234 C 178.177 69.599,180.225 99.462,199.061 99.680 C 218.341 99.904,222.350 72.041,203.939 65.779 C 200.947 64.762,199.247 64.634,196.698 65.234 M345.617 94.483 C 334.640 99.916,337.894 118.016,349.844 117.996 C 360.123 117.979,365.237 104.467,357.785 97.015 C 354.412 93.642,349.417 92.602,345.617 94.483 M47.494 94.449 C 34.805 97.325,35.548 117.528,48.385 118.692 C 58.772 119.634,64.828 106.563,57.753 98.475 C 54.834 95.138,51.033 93.646,47.494 94.449 M227.800 111.463 C 220.148 113.269,217.420 114.667,213.077 119.010 C 203.652 128.435,201.712 144.306,208.507 156.400 C 209.843 158.778,215.659 164.904,217.233 165.591 C 217.765 165.823,218.920 166.421,219.800 166.920 C 239.755 178.227,263.265 157.519,257.968 133.300 C 254.962 119.553,239.855 108.618,227.800 111.463 M161.892 112.226 C 146.984 115.838,137.783 132.785,142.033 148.800 C 149.636 177.443,187.572 176.770,194.409 147.871 C 195.314 144.047,195.540 137.242,194.841 134.893 C 194.627 134.174,194.459 133.544,194.468 133.493 C 194.702 132.185,191.181 124.519,189.141 121.893 C 182.736 113.649,171.894 109.802,161.892 112.226 M103.118 124.387 C 91.706 127.431,86.418 139.214,91.674 149.889 C 96.947 160.601,111.298 161.954,118.171 152.387 C 120.119 149.676,121.517 146.364,122.021 143.270 C 122.920 137.751,119.086 129.964,113.807 126.588 C 112.092 125.490,106.911 123.517,106.058 123.636 C 105.916 123.656,104.593 123.994,103.118 124.387 M289.714 124.154 C 271.552 130.111,275.679 159.315,294.543 158.325 C 308.791 157.577,315.259 138.994,304.905 128.557 C 300.829 124.448,294.453 122.600,289.714 124.154 M259.800 170.792 C 241.318 172.967,230.565 195.773,239.474 213.899 C 247.681 230.598,270.104 234.398,282.230 221.145 C 298.615 203.238,289.565 174.099,266.600 170.816 C 263.541 170.379,263.316 170.378,259.800 170.792 M130.400 171.425 C 117.617 174.754,108.309 188.457,109.360 202.400 C 110.366 215.741,118.736 225.864,131.200 228.814 C 154.505 234.331,172.297 205.744,159.150 183.907 C 153.219 174.055,140.878 168.697,130.400 171.425 M339.185 184.757 C 329.968 186.641,324.438 197.392,328.411 205.702 C 335.951 221.471,357.048 214.306,354.319 196.903 C 353.197 189.751,345.393 183.488,339.185 184.757 M54.523 186.356 C 44.663 190.002,42.203 203.958,50.062 211.661 C 58.891 220.315,73.692 212.317,72.684 199.437 C 71.937 189.896,62.783 183.302,54.523 186.356 M387.733 190.376 C 383.555 192.178,381.202 198.400,382.868 203.240 C 386.395 213.487,400.771 209.744,399.909 198.804 C 399.425 192.666,392.899 188.147,387.733 190.376 M5.383 191.552 C -3.303 195.497,-0.845 210.210,8.478 210.078 C 14.259 209.996,17.726 206.193,17.696 199.967 C 17.665 193.496,11.053 188.977,5.383 191.552 M162.800 230.777 C 144.685 235.186,135.877 256.126,144.679 273.854 C 145.459 275.424,146.545 277.224,147.093 277.854 C 147.641 278.485,148.542 279.587,149.095 280.304 C 158.986 293.127,180.700 291.190,190.349 276.624 C 204.705 254.951,186.686 224.963,162.800 230.777 M226.054 230.630 C 209.703 235.028,200.515 253.201,206.366 269.572 C 213.132 288.501,233.867 294.802,248.592 282.403 C 250.144 281.096,253.190 277.875,253.196 277.535 C 253.198 277.389,253.833 276.309,254.607 275.135 C 268.123 254.635,248.797 224.512,226.054 230.630 M289.400 241.924 C 272.639 247.965,275.690 275.449,293.178 275.960 C 305.110 276.308,313.301 263.957,308.985 252.124 C 306.065 244.117,296.761 239.272,289.400 241.924 M101.600 242.327 C 87.334 247.067,85.846 268.305,99.324 274.806 C 106.539 278.286,115.676 275.414,119.708 268.400 C 127.345 255.115,115.302 237.773,101.600 242.327 M348.074 281.613 C 343.182 282.617,338.298 289.265,339.031 293.922 C 339.124 294.515,339.300 295.592,339.421 296.316 C 340.880 305.002,351.172 308.847,357.646 303.124 C 360.782 300.351,361.938 296.602,361.406 290.923 C 360.839 284.880,354.323 280.329,348.074 281.613 M46.600 282.470 C 34.182 287.114,37.129 307.220,50.096 306.320 C 62.407 305.465,65.476 288.926,54.396 283.151 C 52.369 282.095,48.506 281.757,46.600 282.470 M194.304 300.963 C 179.048 306.542,179.642 330.152,195.151 334.661 C 203.031 336.952,213.138 330.201,214.740 321.576 C 217.214 308.256,205.812 296.754,194.304 300.963 M127.549 317.560 C 120.924 318.920,116.962 324.059,115.777 332.832 C 115.456 335.206,117.602 339.862,120.454 342.982 C 129.726 353.128,145.626 343.625,143.150 329.417 C 141.827 321.824,134.373 316.160,127.549 317.560 M266.188 317.812 C 251.591 323.209,255.970 347.721,271.352 346.712 C 285.821 345.763,289.381 325.237,276.243 318.510 C 273.705 317.210,268.747 316.866,266.188 317.812 M293.267 369.447 C 288.098 371.704,285.475 378.471,287.937 383.200 C 292.577 392.114,304.808 389.066,304.787 379.000 C 304.775 372.786,298.168 367.308,293.267 369.447 M101.739 370.155 C 97.361 372.146,94.531 377.588,95.845 381.486 C 98.346 388.902,105.333 391.371,110.636 386.714 C 117.988 380.259,110.434 366.200,101.739 370.155 M195.306 376.333 C 187.402 379.543,185.362 390.064,191.357 396.700 C 197.272 403.247,208.312 399.718,210.186 390.682 L 210.867 387.400 209.792 384.024 C 207.644 377.279,201.287 373.903,195.306 376.333'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E",
    _events: {},
  },
};
